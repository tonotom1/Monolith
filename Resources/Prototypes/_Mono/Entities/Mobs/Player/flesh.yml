# SPDX-FileCopyrightText: 2025 starch
#
# SPDX-License-Identifier: AGPL-3.0-or-later

# TODO - new sprites
# TODO - hivemind (goob type shi)

- type: entity
  parent:
  - MobNonHumanHostileBase
  - MobHumanoidHostileAISimpleMelee
  - MobLaserReflect
  id: MonoBaseMobFleshLetoferol
  name: letoferol flesh
  description: A shambling mass of flesh, made with the horrors of Letoferol.
  abstract: true
  components:
  - type: NpcFactionMember
    factions:
    - AberrantFleshExpeditionNF
  - type: Sprite
    drawdepth: Mobs
    sprite: _NF/Mobs/Aliens/flesh.rsi
  - type: MobState
    allowedStates:
    - Alive
    - Dead
  - type: MobThresholds
    thresholds:
      0: Alive
      250: Dead
  - type: SlowOnDamage
    speedModifierThresholds:
      50: 0.7
      120: 0.5
  - type: Stamina
    critThreshold: 150
  - type: Butcherable
    spawned:
    - id: FoodMeat
      amount: 4
  - type: Bloodstream
    bloodReagent: Letoferol
    bloodMaxVolume: 300
  - type: MeleeWeapon
    attackRate: 1.5
    soundHit:
      path: /Audio/Weapons/Xeno/alien_claw_flesh3.ogg
    angle: 30
    animation: WeaponArcClaw
    damage:
      types:
        Blunt: 12
        Slash: 20
        Structural: 50
  - type: ReplacementAccent
    accent: genericAggressive
  - type: SolutionContainerManager
    solutions:
      melee:
        reagents:
        - ReagentId: NaturalLetoferol
          Quantity: 90
  - type: MeleeChemicalInjector
    solution: melee
    transferAmount: 2.5
  - type: MovementSpeedModifier
    baseWalkSpeed : 3.5
    baseSprintSpeed : 4.25
  - type: Hands
  - type: ComplexInteraction
  - type: Ensnareable
    sprite: Objects/Misc/ensnare.rsi
    state: icon
  - type: Tag
    tags:
    - CanPilot
    - DoorBumpOpener
  - type: PassiveDamage
    allowedStates:
    - Alive
    - Dead
    damage:
      types:
        Heat: -0.25
      groups:
        Brute: -0.25
  - type: Targeting
  - type: Puller
    needsHands: false
  - type: Body
    prototype: Skeleton
    requiredLegs: 2
  - type: Reactive
    groups:
      Flammable: [ Touch ]
      Extinguish: [ Touch ]
    reactions:
    - reagents: [ Letoferol, Romerol ]
      methods: [ Touch ]
      effects:
      - !type:HealthChange
        scaleByQuantity: true
        damage:
          groups:
            Burn: -2
            Brute: -1.5
    - reagents: [ Mesotaxinide ]
      methods: [ Touch ]
      effects:
      - !type:HealthChange
        scaleByQuantity: true
        damage:
          groups:
            Burn: 6
            Brute: 7
          types:
            Caustic: 20
            Cellular: 5
  - type: PlayerToolModifier
    pryTimeMultiplier: 0.4
  - type: PlayerAccuracyModifier
    spreadMultiplier: 12
    maxSpreadAngle: 180
  - type: BonusMeleeDamage
    damageModifierSet:
      coefficients:
        Blunt: 1.4
        Slash: 1.2
        Piercing: 0.65 # spear is clunky
        Heat: 0.5 # fire is scary (esword is op)

- type: entity
  parent: MonoBaseMobFleshLetoferol
  id: MobLetoferolHorror
  name: letoferol flesh creature
  description:
  components:
  - type: MovementSpeedModifier
    baseWalkSpeed : 2.7
    baseSprintSpeed : 4.65
  - type: Sprite
    layers:
    - map: ["enum.DamageStateVisualLayers.Base"]
      state: horror
      color: "#eaff00"
  - type: DamageStateVisuals
    states:
      Alive:
        Base: horror
      Dead:
        Base: dead
  - type: MobState
    allowedStates:
    - Alive
    - Dead
  - type: MobThresholds
    thresholds:
      0: Alive
      450: Dead
    allowRevives: true
  - type: SlowOnDamage
    speedModifierThresholds:
      120: 0.7
      250: 0.5
  - type: MeleeWeapon
    autoAttack: true
    attackRate: 1.2
    soundHit:
      path: /Audio/Weapons/Xeno/alien_claw_flesh3.ogg
    angle: 60
    animation: WeaponArcClaw
    damage:
      types:
        Slash: 17
        Poison: 4
        Pierce: 2
        Structural: 75
  - type: ActionGun
    action: ActionLetoferolSpike
    gunProto: LetoferolSpikeGun

- type: entity
  id: LetoferolSpikeGun
  name: letoferol bone spike
  description: Shoots a short salvo of bone spikes.
  categories: [ HideSpawnMenu ]
  components:
  - type: RechargeBasicEntityAmmo
    rechargeCooldown: 5
    rechargeSound:
      path: /Audio/Animals/space_dragon_roar.ogg
  - type: BasicEntityAmmoProvider
    proto: LetoferolHorrorSpikeSpread #DartAberrantFleshHorrorSpike
    capacity: 2
    count: 2
  - type: Gun
    minAngle: 5
    maxAngle: 15
    fireRate: 4
    selectedMode: FullAuto
    availableModes:
    - FullAuto
    soundGunshot:
      path: /Audio/Items/bow_pull.ogg
    soundEmpty: null
    projectileSpeed: 30

- type: entity
  id: LetoferolHorrorSpikeSpread
  parent: LetoferolHorrorSpike
  categories: [ HideSpawnMenu ]
  components:
  - type: ProjectileSpread
    proto: LetoferolHorrorSpike
    count: 5
    spread: 4

- type: entity
  id: LetoferolHorrorSpike
  name: letoferol bone spike
  parent: DartAberrantFleshHorrorSpike
  categories: [ HideSpawnMenu ]
  components:
  - type: SolutionContainerManager
    solutions:
      ammo:
        maxVol: 3
        reagents:
        - ReagentId: NaturalLetoferol
          Quantity: 1.5
  - type: SolutionContainerVisuals
    maxFillLevels: 1
    fillBaseName: spikeSolution
  - type: Projectile
    damage:
      types:
        Piercing: 4

- type: entity
  id: ActionLetoferolSpike
  categories: [ HideSpawnMenu ]
  name: "[color=yellow]Bone Spike[/color]"
  description: "Shoot a short salvo of bone spikes laced with letoferol. [color=yellow]5 second cooldown.[/color]"
  components:
  - type: WorldTargetAction
    icon: { sprite : _NF/Mobs/Aliens/flesh.rsi, state: spike }
    event: !type:ActionGunShootEvent
    priority: 2
    checkCanAccess: false
    range: 0
    itemIconStyle: BigAction
